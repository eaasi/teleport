version: "3"

services:
    eaasi-database:
        image: eaasi-database
        build:
            context: ./eaasi-client-database
        env_file:
            - ./eaasi-client-database/vars.env
        ports:
            - 5432:5432
        volumes:
            - eaasi_db:/var/lib/postgresql/data

    eaasi-client:
        image: eaasi-client
        build:
            context: ./eaasi-front-end
        ports:
            - 8080:80
        environment:
            - API_URL=http://localhost:8081

    eaasi-web-api:
        image: eaasi-web-api
        build:
            context: ./eaasi-client-web-api
        depends_on:
           - eaasi-database
        environment:
            - API_DATABASE_URL=eaasi-database:5432
        command: >
            bash -c "./wait-for-it.sh eaasi-database:5432 -- runmigration && npm run dev"

volumes:
    eaasi_db:
